/* 
 * @Author: Linuxenko Svetlana 
 * @Project: CakeJS https://github.com/linuxenko/cakejs 
 */
!function(){"use strict";var a=function(){this.scope={libPath:"",appPath:"",params:[],modules:[]},this.route={name:"",routes:[],params:[]};var a=function(){var a=this,b=function(){var b,c,d=document.getElementsByTagName("script");for(b=0;b<d.length;b++)if(c=d[b],"string"==typeof c.getAttribute("data-main")){a.scope.libPath=c.getAttribute("src").match(/^(.*\/).+\.js$/)[1]||null,a.scope.appPath=c.getAttribute("data-main")||null;break}};b()};this.load=function(a,b){var c=a.length,d=null,e=0;"undefined"!=typeof $&&(d=$.Deferred());var f=function(){--c<=0&&("function"==typeof b&&b(),null!==d&&d.resolve())};for(e in a)this.require(a[e],f.bind(this));return d},this.router=function(a){var b=this;b.route.routes=a;var c=function(a){var c=b.route.routes[a],d=0;"undefined"!=typeof c.controllers&&b.load(c.controllers,function(){for(d=0;d<c.controllers.length;d++)b.findModule(c.controllers[d]).active=!1,b.startModule.call(b,c.controllers[d])})},d=function(){var a=window.location.hash;if(a.length<1)return c("home");for(var d=a.split("/"),e=d[0].match(/^#(.*)$/)[1],f=[],g=1;g<d.length;g++)f.push(d[g]);b.route.backName=b.route.name.toString(),b.route.backParams=b.route.params,"undefined"!=typeof b.route.URL&&"logout"!=b.route.backName&&(b.route.backURL=b.route.URL),b.route.URL=window.location.href,b.route.name=e,b.route.params=f,c(e)};window.onpopstate=d,d()},this.startModule=function(a){var b,c=this,d=c.findModule(a),e={},f=0;if(null!==d&&d.active!==!0){for(;f<d.deps.length;f++){if(b=c.findModule(d.deps[f]),!b)return c.load(d.deps,c.startModule.bind(c,a));e[b.name]=b.module}d.active=!0,"function"==typeof d.module&&d.module(e),"object"==typeof d.module&&"function"==typeof d.module.init&&d.module.init(e)}},this.findModule=function(a){for(var b in this.scope.modules)if(this.scope.modules[b].name==a)return this.scope.modules[b];return null},this.require=function(a,b){var c,d=this,e=a,f=b,g=null,h=(d.scope.modules,null);return"undefined"!=typeof $&&(g=$.Deferred()),"undefined"!=typeof e?null!==(h=d.findModule(e))?(g.resolve(h.module),"function"==typeof f&&f(h.module),void("function"==typeof h.module&&d.define(h.name,h.deps,h.module))):(e.match(/^.*\.js/)||(e=d.scope.appPath+e+".js"),c=document.createElement("script"),c.setAttribute("src",e),c.onload=c.onreadystatechange=function(){"function"==typeof f&&f(this),null!==g&&g.resolve(this)},c.onerror=function(a){null!==g&&g.reject(a)},document.head.appendChild(c),g):void 0},this.define=function(a,b,c){var d=this.scope.modules,e=function(a){for(var b in d)if(d[b].name==a)return!0;return!1},f=function(a){e(a.name)||d.push(a)},g=function(){},h=c;"string"==typeof a&&("undefined"==typeof h&&(h=b),"object"!=typeof b||"object"!=typeof c&&"function"!=typeof c?"function"==typeof h&&"App"==a&&h():g.call(this,b,a),f({name:a,deps:b,module:h,active:"App"==a}))},this.t=function(a,b){var c=function(a){return a.innerHTML.replace(/<!--\?/gi,"<?").replace(/\?-->/gi,"?>")},d=function(a,b){var c=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<?").join("	").replace(/((^|\?>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)\?>/g,"',$1,'").split("	").join("');").split("?>").join("p.push('").split("\r").join("\\'")+"');return p.join('');};");return c(b)};try{return d(c(document.getElementById(a)),b)}catch(e){throw"No template found: "+a}return null},a.call(this)};window.$c=new a}();